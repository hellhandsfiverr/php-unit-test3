## OMNI Library
This is the ADR OMNI API Wrapper Library

Install
Via Composer

```
composer config repositories.omni-sdk vcs git@bitbucket.org:alldigitalrewards/omni-sdk.git
$ composer require alldigitalrewards/omni-sdk
```

## Usage

###Client setup
```
$username = 'technology@alldigitalrewards.com';
$password = '9m9k9Tx2$g!aV5XLV&$D';
$httpClient = new \GuzzleHttp\Client([
    'base_uri' => 'https://api.omnicard.com/2.x/',
    'http_errors' => false
]);

$omni = new \AllDigitalRewards\Omni\Client($username, $password, $httpClient);
```
###Request Token
```
For each API request, you must use a token that is generated by the OmniCard system. 
You will use this call to generate a token that will be used on all of the other API calls. 
This is the only call that requires your username and password in the request. 
Use this call to request a token which will be supplied for all other requests. 
The token you receive will expire within 7 days from when it is issued. 
You may request a new token at any time, you do not need to wait for your existing token to expire.

$request = new \AllDigitalRewards\Omni\Request\TokenRequest();

$response = $omni->requestToken($request);

print_r($response);
```

####Start Order then Add to Order then Complete Order is the OMNI Process for Creating an Order

###Egift Start Order
```
$request = new \AllDigitalRewards\Omni\Request\EgiftCardRequest();
$request->startOrder(
  string $merchant_code,
  string $merchant_template_id
);
$response = $omni->egiftStartOrder($request);
print_r($response);
```
###Egift Add To Order
```
//using order_id # from Start Order response
$request = new \AllDigitalRewards\Omni\Request\EgiftCardRequest();
$cardConfig = [
    'first_name' => 'Joe',
    'last_name' => 'Muto',
    'denomination' => 5.00,
    'message' => 'My First Omni Order- Test'
];
$request->addCardOrder(52177864, $cardConfig);
$response = $omni->egiftAddCardToOrder($request);
print_r($response);
```


###Egift Complete Order
```
//using order_id # from Start Order response
//Payment types: wire, check, fundsbank
$request = new \AllDigitalRewards\Omni\Request\EgiftCardRequest();
$request->completeOrder(52177864, 'wire');
$response = $omni->egiftCompleteOrder($request);
print_r($response);
```

###Egift Get Order
```
//using order_id # from Start Order response
$request = new \AllDigitalRewards\Omni\Request\EgiftCardRequest();
$request->getOrder(52177864);
$response = $omni->egiftGetOrder($request);
print_r($response);
```
###Egift Get Orders
```
$request = new \AllDigitalRewards\Omni\Request\EgiftCardRequest();
$request->getOrders();
$response = $omni->egiftGetOrders($request);
print_r($response);
```

## Testing

```
$ composer test
```

## Code Style
This repository implements PSR2 code style. Please run composer check-style before opening PRs. If necessary composer fix-style can be used to automatically clean up issues.
